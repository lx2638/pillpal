<script>
    // --- Medication Tracker Functionality ---
    function saveMedications() {
        localStorage.setItem('medications', JSON.stringify(medications));
    }

    function renderMedicationList() {
        medicationList.innerHTML = '';
        medications.sort((a, b) => a.timeInMs - b.timeInMs);

        medications.forEach(med => {
            const li = document.createElement('li');
            li.className = 'medication-item';
            li.dataset.id = med.id;

            const statusLabel = getStatusLabel(med);

            li.innerHTML = `
                <div class="med-info">
                    <div class="med-name">${med.name}</div>
                    <div class="med-details">
                        ${med.dosage} Â· ${formatTime(med.time)}
                    </div>
                </div>
                <div>
                    <span class="med-status ${statusLabel.class}">${statusLabel.text}</span>
                    <button class="delete-btn" onclick="deleteMedication(${med.id})">Delete</button>
                </div>
            `;

            medicationList.appendChild(li);

            // Mark as taken on click (except when clicking delete button)
            li.addEventListener('click', (e) => {
                if (e.target.tagName !== 'BUTTON') {
                    markAsTaken(med.id);
                }
            });
        });

        if (medications.length === 0) {
            medicationList.innerHTML = '<p>No medications added yet.</p>';
        }
    }

    // Add this new function for deleting medications
    function deleteMedication(id) {
        if (confirm('Are you sure you want to delete this medication?')) {
            const medIndex = medications.findIndex(med => med.id === parseInt(id));
            if (medIndex !== -1) {
                const deletedMed = medications[medIndex];
                medications.splice(medIndex, 1);
                saveMedications();
                renderMedicationList();
                showNotification(`${deletedMed.name} deleted successfully!`, 'success');
            }
        }
    }
</script>
